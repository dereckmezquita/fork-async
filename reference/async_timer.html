<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Repeated timer — async_timer • async</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Repeated timer — async_timer"><meta name="description" content="The supplied callback function will be called by the event loop
every delay seconds."><meta property="og:description" content="The supplied callback function will be called by the event loop
every delay seconds."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">async</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/internals.html">Internals of the async package</a></li>
    <li><a class="dropdown-item" href="../articles/async-example.html">Examples for the async package</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/gaborcsardi/async" target="_blank"><span class="fa fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://exmaple-domain.com" target="_blank">exmaple-domain.com</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Repeated timer</h1>
      <small class="dont-index">Source: <a href="https://github.com/gaborcsardi/async/blob/main/R/timer.R" class="external-link"><code>R/timer.R</code></a></small>
      <div class="d-none name"><code>async_timer.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The supplied callback function will be called by the event loop
every <code>delay</code> seconds.</p>
    </div>


    <div class="section level2">
    <h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h2>



<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>t <span class="ot">&lt;-</span> async_timer<span class="sc">$</span><span class="fu">new</span>(delay, callback)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>t<span class="sc">$</span><span class="fu">cancel</span>()</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<ul><li><p><code>delay</code>: Time interval in seconds, the amount of time to delay
to delay the execution. It can be a fraction of a second.</p></li>
<li><p><code>callback</code>: Callback function without arguments. It will be called
from the event loop every <code>delay</code> seconds.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>



<p>An <code>async_timer</code> is an <code>[event_emitter]</code> object with a <code>timeout</code> event.
It is possible to add multiple listeners to this event, once the timer
is created. Note, however, that removing all listeners does not cancel
the timer, <code>timeout</code> events will be still emitted as usual.
For proper cancellation you'll need to call the <code>cancel()</code> method.</p>
<p>It is only possible to create <code>async_timer</code> objects in an asynchronous
context, i.e. within a <code><a href="synchronise.html">synchronise()</a></code> or <code><a href="run_event_loop.html">run_event_loop()</a></code> call.
A <code><a href="synchronise.html">synchronise()</a></code> call finishes as soon as its returned deferred value
is resolved (or rejected), even if some timers are still active. The
active timers will be automatically cancelled in this case.</p>
    </div>
    <div class="section level2">
    <h2 id="errors">Errors<a class="anchor" aria-label="anchor" href="#errors"></a></h2>


<p>Errors are handled the same way as for generic event emitters. I.e. to
catch errors thrown in the <code>callback</code> function, you need to add a
listener to the <code>error</code> event, see the example below.</p>
    </div>
    <div class="section level2">
    <h2 id="congestion">Congestion<a class="anchor" aria-label="anchor" href="#congestion"></a></h2>


<p><code>async_timer</code> is <em>not</em> a real-time timer. In particular, if <code>callback</code>
does not return in time, before the next timer event, then all future
timer events will be delayed. Even if <code>callback</code> returns promptly, the
event loop might be busy with other events, and then the next timer
event is not emitted in time. In general there is no guarantee about
the timing of the timer events.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Call 10 times a second, cancel with 1/10 probability</span></span></span>
<span class="r-in"><span><span class="va">counter</span> <span class="op">&lt;-</span> <span class="fl">0L</span></span></span>
<span class="r-in"><span><span class="va">do</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">cb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"called\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">counter</span> <span class="op">&lt;&lt;-</span> <span class="va">counter</span> <span class="op">+</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span> <span class="va">t</span><span class="op">$</span><span class="fu">cancel</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">async_timer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="va">cb</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="run_event_loop.html">run_event_loop</a></span><span class="op">(</span><span class="fu">do</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-in"><span><span class="va">counter</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Error handling</span></span></span>
<span class="r-in"><span><span class="va">counter</span> <span class="op">&lt;-</span> <span class="fl">0L</span></span></span>
<span class="r-in"><span><span class="va">do</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">cb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"called\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">counter</span> <span class="op">&lt;&lt;-</span> <span class="va">counter</span> <span class="op">+</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">2L</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"foobar"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">3L</span><span class="op">)</span> <span class="va">t</span><span class="op">$</span><span class="fu">cancel</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">async_timer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="va">cb</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">err</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Got error:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sQuote.html" class="external-link">sQuote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">err</span><span class="op">)</span><span class="op">)</span>, <span class="st">", handled\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">t</span><span class="op">$</span><span class="fu">listen_on</span><span class="op">(</span><span class="st">"error"</span>, <span class="va">handler</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="run_event_loop.html">run_event_loop</a></span><span class="op">(</span><span class="fu">do</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Got error: ‘foobar’ , handled</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-in"><span><span class="va">counter</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Error handling at the synchonization point</span></span></span>
<span class="r-in"><span><span class="va">counter</span> <span class="op">&lt;-</span> <span class="fl">0L</span></span></span>
<span class="r-in"><span><span class="va">do</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">cb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"called\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">counter</span> <span class="op">&lt;&lt;-</span> <span class="va">counter</span> <span class="op">+</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">2L</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"foobar"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">3L</span><span class="op">)</span> <span class="va">t</span><span class="op">$</span><span class="fu">cancel</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">async_timer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="va">cb</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="run_event_loop.html">run_event_loop</a></span><span class="op">(</span><span class="fu">do</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;simpleError in lst$cb(...): foobar&gt;</span>
<span class="r-in"><span><span class="va">counter</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

